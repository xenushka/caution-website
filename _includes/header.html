{%- assign page_paths = site.header_pages | default: default_paths -%}

<header class="header-navbar">
	<div class="nav-top-bar container">
		<a href="/index.html" class="nav-logo">
			<img src="/assets/base/caution-logo/logo-bw.svg" alt="Caution logo" />
		</a>

		<nav class="nav-desktop">
			<div class="nav-glass-container">
				<a href="#" class="nav-link">Platform</a>
				<a href="/about.html" class="nav-link">About</a>
				<a href="/blog.html" class="nav-link">Blog</a>
				<a href="#" class="nav-cta">
					Join Waitlist

						<path d="M7 7h10v10"></path>
						<path d="M7 17 17 7"></path>
					</svg>
				</a>
			</div>
		</nav>

		<button
			class="mobile-menu-button"
			id="mobile-menu-button"
			aria-expanded="false"
			aria-label="Toggle menu"
		>
			<svg
				xmlns="http://www.w3.org/2000/svg"
				width="24"
				height="24"
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="1.5"
				stroke-linecap="round"
				stroke-linejoin="round"
			>
				<path d="M4 5h16"></path>
				<path d="M4 12h16"></path>
				<path d="M4 19h16"></path>
			</svg>
		</button>
	</div>

	<!-- Mobile menu -->
	<div id="mobile-menu" class="mobile-menu">
		<div class="mobile-menu-content">
			<a href="#" class="mobile-menu-link">Home</a>
			<a href="#" class="mobile-menu-link">Platform</a>
			<a href="/about.html" class="mobile-menu-link">About</a>
			<a href="/blog.html" class="mobile-menu-link">Blog</a>
			<a href="#" class="mobile-menu-cta">
				Join Waitlist
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="18"
					height="18"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="1.5"
					stroke-linecap="round"
					stroke-linejoin="round"
				>
					<path d="M7 7h10v10"></path>
					<path d="M7 17 17 7"></path>
				</svg>
			</a>
		</div>
	</div>
</header>

<script>
	// Adaptive logo color based on background
	function updateLogoColor() {
		const navbar = document.querySelector(".header-navbar");

		if (!navbar) return;

		// For landing-v2, the hero now has a light radial gradient background
		// So the logo should always be dark (not inverted)
		navbar.classList.remove("navbar--on-dark");
	}

	// Update on load for landing-v2 page
	if (document.body.classList.contains("landing-v2")) {
		window.addEventListener("load", updateLogoColor);
	}

	// Mobile menu toggle
	document.addEventListener("DOMContentLoaded", function () {
		const mobileMenuButton = document.getElementById("mobile-menu-button");
		const mobileMenu = document.getElementById("mobile-menu");

		if (mobileMenuButton && mobileMenu) {
			mobileMenuButton.addEventListener("click", () => {
				const isExpanded =
					mobileMenuButton.getAttribute("aria-expanded") === "true";
				mobileMenuButton.setAttribute("aria-expanded", !isExpanded);
				mobileMenu.classList.toggle("active");
			});
		}

		// Intent-based auto-hiding navbar
		const navbar = document.querySelector(".header-navbar");
		if (!navbar) return;

		let lastScrollY = window.scrollY;
		let ticking = false;
		let isNavbarVisible = true;

		// Thresholds for scroll behavior
		const SCROLL_THRESHOLD = 5; // Minimum scroll distance to trigger hide/show (prevents jitter)
		const SHOW_THRESHOLD = 10; // Pixels to scroll up before showing navbar
		const TOP_THRESHOLD = 100; // Distance from top where navbar always shows

		// Debounced scroll handler for performance
		function handleScroll() {
			if (!ticking) {
				window.requestAnimationFrame(() => {
					updateNavbarVisibility();
					ticking = false;
				});
				ticking = true;
			}
		}

		// Intent detection: show navbar when scrolling up, hide when scrolling down
		function updateNavbarVisibility() {
			const currentScrollY = window.scrollY;
			const scrollDelta = currentScrollY - lastScrollY;

			// Always show navbar when near the top
			if (currentScrollY < TOP_THRESHOLD) {
				showNavbar();
				lastScrollY = currentScrollY;
				return;
			}

			// Check scroll direction and apply threshold to prevent jitter
			if (Math.abs(scrollDelta) > SCROLL_THRESHOLD) {
				if (scrollDelta > 0) {
					// Scrolling down - hide navbar
					hideNavbar();
				} else if (Math.abs(scrollDelta) > SHOW_THRESHOLD) {
					// Scrolling up with intent - show navbar
					showNavbar();
				}
			}

			lastScrollY = currentScrollY;
		}

		function hideNavbar() {
			if (isNavbarVisible) {
				navbar.classList.add("navbar--hidden");
				isNavbarVisible = false;
			}
		}

		function showNavbar() {
			if (!isNavbarVisible) {
				navbar.classList.remove("navbar--hidden");
				isNavbarVisible = true;
			}
		}

		// Attach scroll listener
		window.addEventListener("scroll", handleScroll, { passive: true });

		// Cleanup on page unload (prevents memory leaks)
		window.addEventListener("beforeunload", () => {
			window.removeEventListener("scroll", handleScroll);
		});
	});
</script>
